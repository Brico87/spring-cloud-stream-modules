<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 4. Sinks</title><link rel="stylesheet" type="text/css" href="docbook-epub.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"/><link rel="prev" href="ch03s07.xhtml" title="Splitter"/><link rel="next" href="ch04s02.xhtml" title="Counter (counter)"/></head><body><header/><section class="chapter" title="Chapter 4. Sinks" epub:type="chapter" id="spring-cloud-stream-modules-sinks"><div class="titlepage"><div><div><h2 class="title">Chapter 4. Sinks</h2></div></div></div><section class="section" title="Cassandra (cassandra)" epub:type="subchapter" id="spring-cloud-stream-modules-cassandra"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Cassandra (<code class="literal">cassandra</code>)</h2></div></div></div><p>The Cassandra sink writes into a Cassandra table.  Here is a simple example</p><pre class="literallayout">dataflow:&gt;stream create cassandrastream --definition "http --server.port=8888 --spring.cloud.stream.bindings.output.contentType='application/json' | cassandra --ingestQuery='insert into book (id, isbn, title, author) values (uuid(), ?, ?, ?)' --spring.cassandra.keyspace=clouddata" --deploy</pre><p>Create a keyspace and a <code class="literal">book</code> table in Cassandra using:</p><pre class="programlisting">CREATE KEYSPACE clouddata WITH REPLICATION = { 'class' : 'org.apache.cassandra.locator.SimpleStrategy', 'replication_factor': '1' } AND DURABLE_WRITES = true;
USE clouddata;
CREATE TABLE book  (
    id          uuid PRIMARY KEY,
    isbn        text,
    author      text,
    title       text
);</pre><p>You can then send data to this stream via</p><pre class="literallayout">dataflow:&gt;http post --contentType 'application/json' --data '{"isbn": "1599869772", "title": "The Art of War", "author": "Sun Tzu"}' --target http://localhost:8888/
&gt; POST (application/json;charset=UTF-8) http://localhost:8888/ {"isbn": "1599869772", "title": "The Art of War", "author": "Sun Tzu"}
&gt; 202 ACCEPTED</pre><p>and see the table contents using the CQL</p><pre class="literallayout">SELECT * FROM clouddata.book;</pre><section class="section" title="Options" epub:type="division" id="_options_17"><div class="titlepage"><div><div><h3 class="title">Options</h3></div></div></div><p>The <span class="strong"><strong>cassandra</strong></span> sink has the following options:</p><div class="variablelist" epub:type="list"><dl class="variablelist"><dt><span class="term">compressionType</span></dt><dd>the compression to use for the transport <span class="strong"><strong>(CompressionType, default: <code class="literal">NONE</code>, possible values: <code class="literal">NONE,SNAPPY</code>)</strong></span></dd><dt><span class="term">consistencyLevel</span></dt><dd>the consistencyLevel option of WriteOptions <span class="strong"><strong>(ConsistencyLevel, no default, possible values: <code class="literal">ANY,ONE,TWO,THREE,QUOROM,LOCAL_QUOROM,EACH_QUOROM,ALL,LOCAL_ONE,SERIAL,LOCAL_SERIAL</code>)</strong></span></dd><dt><span class="term">spring.cassandra.contactPoints</span></dt><dd>the comma-delimited string of the hosts to connect to Cassandra <span class="strong"><strong>(String, default: <code class="literal">localhost</code>)</strong></span></dd><dt><span class="term">entityBasePackages</span></dt><dd>the base packages to scan for entities annotated with Table annotations <span class="strong"><strong>(String[], default: <code class="literal">[]</code>)</strong></span></dd><dt><span class="term">ingestQuery</span></dt><dd>the ingest Cassandra query <span class="strong"><strong>(String, no default)</strong></span></dd><dt><span class="term">spring.cassandra.initScript</span></dt><dd>the path to file with CQL scripts (delimited by ';') to initialize keyspace schema <span class="strong"><strong>(String, no default)</strong></span></dd><dt><span class="term">spring.cassandra.keyspace</span></dt><dd>the keyspace name to connect to <span class="strong"><strong>(String, default: <code class="literal">&lt;stream name&gt;</code>)</strong></span></dd><dt><span class="term">metricsEnabled</span></dt><dd>enable/disable metrics collection for the created cluster <span class="strong"><strong>(boolean, default: <code class="literal">true</code>)</strong></span></dd><dt><span class="term">spring.cassandra.password</span></dt><dd>the password for connection <span class="strong"><strong>(String, no default)</strong></span></dd><dt><span class="term">spring.cassandra.port</span></dt><dd>the port to use to connect to the Cassandra host <span class="strong"><strong>(int, default: <code class="literal">9042</code>)</strong></span></dd><dt><span class="term">queryType</span></dt><dd>the queryType for Cassandra Sink <span class="strong"><strong>(Type, default: <code class="literal">INSERT</code>, possible values: <code class="literal">INSERT,UPDATE,DELETE,STATEMENT</code>)</strong></span></dd><dt><span class="term">retryPolicy</span></dt><dd>the retryPolicy  option of WriteOptions <span class="strong"><strong>(RetryPolicy, no default, possible values: <code class="literal">DEFAULT,DOWNGRADING_CONSISTENCY,FALLTHROUGH,LOGGING</code>)</strong></span></dd><dt><span class="term">statementExpression</span></dt><dd>the expression in Cassandra query DSL style <span class="strong"><strong>(String, no default)</strong></span></dd><dt><span class="term">spring.cassandra.schemaAction</span></dt><dd>schema action to perform <span class="strong"><strong>(SchemaAction, default: <code class="literal">NONE</code>, possible values: <code class="literal">CREATE,NONE,RECREATE,RECREATE_DROP_UNUSED</code>)</strong></span></dd><dt><span class="term">ttl</span></dt><dd>the time-to-live option of WriteOptions <span class="strong"><strong>(int, default: <code class="literal">0</code>)</strong></span></dd><dt><span class="term">spring.cassandra.username</span></dt><dd>the username for connection <span class="strong"><strong>(String, no default)</strong></span></dd></dl></div></section></section></section><footer/></body></html>
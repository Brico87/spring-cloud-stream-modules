<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.&nbsp;Processors</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Stream Reference Guide"><link rel="up" href="_modules.html" title="Part&nbsp;II.&nbsp;Modules"><link rel="prev" href="sources.html" title="2.&nbsp;Sources"><link rel="next" href="spring-cloud-stream-modules-sinks.html" title="4.&nbsp;Sinks"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.&nbsp;Processors</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sources.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;II.&nbsp;Modules</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-stream-modules-sinks.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spring-cloud-stream-modules-processors" href="#spring-cloud-stream-modules-processors"></a>3.&nbsp;Processors</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-filter" href="#spring-cloud-stream-modules-filter"></a>3.1&nbsp;Filter (<code class="literal">filter</code>)</h2></div></div></div><p>Use the filter module in a stream to determine whether a Message should be passed to the output channel.</p><p>The <span class="strong"><strong>filter</strong></span> processor has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd>a SpEL expression used to transform messages <span class="strong"><strong>(String, default: <code class="literal">payload.toString()</code>)</strong></span></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_filter_with_spel_expression" href="#_filter_with_spel_expression"></a>3.1.1&nbsp;Filter with SpEL expression</h3></div></div></div><p>The simplest way to use the filter processor is to pass a SpEL expression when creating the stream. The expression should evaluate the message and return true or false.  For example:</p><pre class="literallayout">dataflow:&gt; stream create --name filtertest --definition "http --server.port=9000 | filter --expression=payload=='good' | log" --deploy</pre><p>This filter will only pass Messages to the log sink if the payload is the word "good". Try sending "good" to the HTTP endpoint and you should see it in the Spring Cloud Data Flow logs:</p><pre class="literallayout">dataflow:&gt; http post --target http://localhost:9000 --data "good"</pre><p>Alternatively, if you send the word "bad" (or anything else), you shouldn&#8217;t see the log entry.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-groovy-filter" href="#spring-cloud-stream-modules-groovy-filter"></a>3.2&nbsp;Groovy Filter (<code class="literal">groovy-filter</code>)</h2></div></div></div><p>A Processor module that retains or discards messages according to a predicate, expressed as a Groovy script.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_options_13" href="#_options_13"></a>3.2.1&nbsp;Options</h3></div></div></div><p>The <span class="strong"><strong>groovy-filter</strong></span> processor has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">script</span></dt><dd>The script resource location <span class="strong"><strong>(String, default: ``)</strong></span></dd><dt><span class="term">variables</span></dt><dd>Variable bindings as a comma delimited string of name-value pairs, e.g. 'foo=bar,baz=car' <span class="strong"><strong>(String, default: ``)</strong></span></dd><dt><span class="term">variablesLocation</span></dt><dd>The location of a properties file containing custom script variable bindings <span class="strong"><strong>(String, default: ``)</strong></span></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-httpclient" href="#spring-cloud-stream-modules-httpclient"></a>3.3&nbsp;Http Client (<code class="literal">httpclient</code>)</h2></div></div></div><p>A processor module that makes requests to an HTTP resource and emits the response body as a message payload. This processor can be combined, e.g., with a time source module to periodically poll results from a HTTP resource.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_options_14" href="#_options_14"></a>3.3.1&nbsp;Options</h3></div></div></div><p>The <span class="strong"><strong>httpclient</strong></span> processor has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">url</span></dt><dd>The URL to issue an http request to, as a static value.</dd><dt><span class="term">urlExpression</span></dt><dd>A SpEL expression against incoming message to determine the URL to use.</dd><dt><span class="term">httpMethod</span></dt><dd>The kind of http method to use.</dd><dt><span class="term">body</span></dt><dd>The (static) body of the request to use.</dd><dt><span class="term">bodyExpression</span></dt><dd>A SpEL expression against incoming message to derive the request body to use.</dd><dt><span class="term">headersExpression</span></dt><dd>A SpEL expression used to derive the http headers map to use.</dd><dt><span class="term">expectedResponseType</span></dt><dd>The type used to interpret the response.</dd><dt><span class="term">replyExpression</span></dt><dd>A SpEL expression used to compute the final result, applied against the whole http response.</dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-bridge" href="#spring-cloud-stream-modules-bridge"></a>3.4&nbsp;Bridge (<code class="literal">bridge</code>)</h2></div></div></div><p>A Processor module that returns messages that is passed by connecting just the input and output channels.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-groovy-transform" href="#spring-cloud-stream-modules-groovy-transform"></a>3.5&nbsp;Groovy Transform (<code class="literal">groovy-transform</code>)</h2></div></div></div><p>A Processor module that transforms messages using a Groovy script.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_options_15" href="#_options_15"></a>3.5.1&nbsp;Options</h3></div></div></div><p>The <span class="strong"><strong>groovy-transform</strong></span> processor has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">script</span></dt><dd>The script resource location <span class="strong"><strong>(String, default: ``)</strong></span></dd><dt><span class="term">variables</span></dt><dd>Variable bindings as a comma delimited string of name-value pairs, e.g. 'foo=bar,baz=car' <span class="strong"><strong>(String, default: ``)</strong></span></dd><dt><span class="term">variablesLocation</span></dt><dd>The location of a properties file containing custom script variable bindings <span class="strong"><strong>(String, default: ``)</strong></span></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-transform" href="#spring-cloud-stream-modules-transform"></a>3.6&nbsp;Transform (<code class="literal">transform</code>)</h2></div></div></div><p>Use the transform module in a stream to convert a Message&#8217;s content or structure.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_options_16" href="#_options_16"></a>3.6.1&nbsp;Options</h3></div></div></div><p>The <span class="strong"><strong>transform</strong></span> processor has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd>a SpEL expression used to transform messages <span class="strong"><strong>(String, default: <code class="literal">payload.toString()</code>)</strong></span></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_transform_with_spel_expression" href="#_transform_with_spel_expression"></a>3.6.2&nbsp;Transform with SpEL expression</h3></div></div></div><p>The simplest way to use the transform processor is to pass a SpEL expression when creating the stream. The expression should return the modified message or payload.  For example:</p><pre class="literallayout">dataflow:&gt; stream create --name transformtest --definition "http --server.port=9003 | transform --expression=payload.toUpperCase() | log" --deploy</pre><p>This transform will convert all message payloads to upper case. If sending the word "foo" to the HTTP endpoint and you should see "FOO" in the Spring Cloud Data Flow logs:</p><pre class="literallayout">dataflow:&gt; http post --target http://localhost:9003 --data "foo"</pre><p>As part of the SpEL expression you can make use of the pre-registered JSON Path function.  The syntax is #jsonPath(payload,'&lt;json path expression&gt;')</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-stream-modules-splitter" href="#spring-cloud-stream-modules-splitter"></a>3.7&nbsp;Splitter</h2></div></div></div><p>The splitter module builds upon the concept of the same name in Spring Integration and allows the splitting of a single
message into several distinct messages.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd>a SpEL expression which would typically evaluate to an array or collection <span class="strong"><strong>(String, default: <code class="literal">null</code>)</strong></span></dd><dt><span class="term">delimiters</span></dt><dd>A list of delimiters to tokenize a String payload ('expression' must be null) <span class="strong"><strong>(String, default: <code class="literal">null</code>)</strong></span></dd><dt><span class="term">fileMarkers</span></dt><dd>Split File payloads, when true, START and END marker messages will be emitted, when false no markers are emitted <span class="strong"><strong>(String, default: <code class="literal">null</code>)</strong></span></dd><dt><span class="term">charset</span></dt><dd>Split File payloads using this charset to convert bytes to String <span class="strong"><strong>(String, default: <code class="literal">null</code>)</strong></span></dd><dt><span class="term">applySequence</span></dt><dd>Add correlation and sequence information to the message headers <span class="strong"><strong>(String, default: <code class="literal">true</code>)</strong></span></dd></dl></div><p>When no <code class="literal">expression</code>, <code class="literal">fileMarkers</code>, or <code class="literal">charset</code> is provided, a <code class="literal">DefaultMessageSplitter</code> is configured with (optional) <code class="literal">delimiters</code>.
When <code class="literal">fileMarkers</code> or <code class="literal">charset</code> is provided, a <code class="literal">FileSplitter</code> is configured (you must provide either a <code class="literal">fileMarkers</code>
or <code class="literal">charset</code> to split files, which must be text-based - they are split into lines).
Otherwise, an <code class="literal">ExpressionEvaluatingMessageSplitter</code> is configured.</p><p>When splitting <code class="literal">File</code> payloads, the <code class="literal">sequenceSize</code> header is zero because the size cannot be determined at the beginning.</p><p><span class="strong"><strong>Ambiguous properties are not allowed.</strong></span></p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_json_example" href="#_json_example"></a>3.7.1&nbsp;JSON Example</h3></div></div></div><p>As part of the SpEL expression you can make use of the pre-registered JSON Path function. The syntax is
<code class="literal">#jsonPath(payload, '&lt;json path expression&gt;')</code>.</p><p>For example, consider the following JSON:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"store"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
    <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"book"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">[</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"category"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"reference"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"author"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Nigel Rees"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"title"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Sayings of the Century"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"price"</span>: <span class="hl-number">8.95</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">},</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"category"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"fiction"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"author"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Evelyn Waugh"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"title"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Sword of Honour"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"price"</span>: <span class="hl-number">12.99</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">},</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"category"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"fiction"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"author"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Herman Melville"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"title"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Moby Dick"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"isbn"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"0-553-21311-3"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"price"</span>: <span class="hl-number">8.99</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">},</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"category"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"fiction"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"author"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"J. R. R. Tolkien"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"title"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"The Lord of the Rings"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"isbn"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"0-395-19395-8"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
            <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"price"</span>: <span class="hl-number">22.99</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">}</span>
    ]<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
    <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"bicycle"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">{</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"color"</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"red"</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">,</span>
        <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"price"</span>: <span class="hl-number">19.95</span>
    <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">}</span>
}<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">}</span></pre><p>and an expression <code class="literal">#jsonPath(payload, '$.store.book')</code>; the result will be 4 messages, each with a <code class="literal">Map</code> payload
containing the properties of a single book.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sources.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_modules.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-stream-modules-sinks.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.&nbsp;Sources&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;4.&nbsp;Sinks</td></tr></table></div></body></html>